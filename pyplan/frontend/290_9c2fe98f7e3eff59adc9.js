/*! Copyright Novix S.A. 2019. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[290,3],{2136:function(a,t,n){"use strict";(function(e,s){var l,o,i=n(18);l=[n(683),n(738),n(2137),n(2138)],void 0===(o=function(a,t,n,l){return e.View.extend({el:s("#main"),render:function(e){var o=this,r=n(this.options.task.id),d=(0,i.translate)("_task_log_search");(new a).show({title:d,html:r,modalClass:"mediumModal filterLogs",buttons:[{title:(0,i.translate)("close"),code:"close"}],callback:function(a,t){if("yes"==a){return e(e),t.modal("hide"),!1}},onLoad:function(a){var t=this;setTimeout(function(){(0,i.postRender)(t.getBase()),t.getBase().find(".fromdatepick").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(a){s(this).datepicker("hide"),t.getBase().find(".form-vertical").valid()}),t.getBase().on("click",".btnSearchLogs",function(){if(event.preventDefault(),t.getBase().find(".loading").show(),!t.getBase().find(".form-vertical").valid())return!1;t.listLog()}),t.getBase().on("click",".showLog",function(n){n.preventDefault();var l=s(n.currentTarget).closest("tr").attr("schedule-task-log-id"),o=s.grep(t.result,function(a){return a.id===l});e(o[0].task_logs),a.modal("hide")})},500)},getBase:function(){return s(".filterLogs")},renderItems:function(a){var t=l({data:a});this.getBase().find("table").find("tbody").append(t),this.instanceTable()},instanceTable:function(){var a=this.getBase().find("table"),t=s(window).height();t-=300,this.getBase().find(".dataTables_scrollBody").css("height",t+"px"),this.getBase().find(".dataTables_scrollBody").css("max-height",t+"px"),a.DataTable({searching:!1,paging:!1,ordering:!1,info:!1,scrollY:t,scrollCollapse:!0})},listLog:function(){var a=this;this.getBase().find(".dataTables_paginate").find(".paginate_button").prop("disabled","disabled"),this.currentFrom<this.pageSize&&(this.currentFrom=1);var n=this.getBase().find("table"),e={periodic_task_id:o.options.task.id},s=this.getBase().find(".taskLogMinDate").val();s&&(e.min_date=s);var l=this.getBase().find(".taskLogMaxDate").val();s&&(e.max_date=l);var i=this.getBase().find(".taskLogStatus").val();""!=i&&(e.state=i);var r=this.getBase().find(".taskLogParams").val();""!=r&&(e.params=JSON.stringify(r.split(",").map(function(a){return a.trim()}))),(new t).filterLogs(e,function(t){a.result=t;var e=n.DataTable();e.clear(),e.destroy(),n.find("tbody").empty();var s=a.formatLog(t);a.searching=!1,a.renderItems(s),a.getBase().find(".loading").hide()})},formatLog:function(a){var t=this;return a&&a.forEach(function(a){a.status=a.state,a.jsonParams=JSON.stringify(a.params),a.created_at=a.created_at.split("T")[0];var n=t.getStatusInfo(a,!1);a.statusStr=n.statusStr,a.statusClass=n.statusClass,a.logDetail=a.info&&Object.entries(a.info).map(function(a){return"".concat(a[0],": ").concat(a[1])}).join("; \n")}),a},getStatusInfo:function(a){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t={statusStr:null,statusClass:null,subtask:null};switch(a.state){case"FAILURE":t.statusStr="Failed",t.statusClass="danger";break;case"SUCCESS":t.statusStr="Completed",t.statusClass="success completed"}return t}})}})}.apply(t,l))||(a.exports=o)}).call(this,n(218),n(1))},2137:function(a,t,n){var e=n(690);function s(a){return a&&(a.__esModule?a.default:a)}a.exports=(e.default||e).template({compiler:[7,">= 4.0.0"],main:function(a,t,e,l,o){var i=null!=t?t:a.nullContext||{},r=a.escapeExpression;return'<form action="#" onsubmit="return false;" id="filterLogsModal" autocomplete="off" class="form-vertical form-validate"\n  novalidate="novalidate">\n  <div class="row">\n\n    <div class="col-sm-6">\n      <div class="form-group">\n        <label for="taskLogMinDate" class="control-label">'+r(s(n(688)).call(i,"_task_log_min_date",{name:"L",hash:{},data:o}))+'</label>\n        <input id="taskLogMinDate" name="taskLogMinDate" type="text" data-rule-required="true"\n          data-date-format="yyyy/mm/dd" class="form-control taskLogMinDate fromdatepick">\n      </div>\n\n      <div class="form-group">\n        <label for="taskLogMaxDate" class="control-label">'+r(s(n(688)).call(i,"_task_log_max_date",{name:"L",hash:{},data:o}))+'</label>\n        <input id="taskLogMaxDate" name="taskLogMaxDate" type="text" data-rule-required="true"\n          data-date-format="yyyy/mm/dd" class="form-control taskLogMaxDate fromdatepick">\n      </div>\n    </div>\n\n    <div class="col-sm-6">\n      <div class="form-group">\n        <label for="taskLogState" class="control-label">'+r(s(n(688)).call(i,"_task_log_state",{name:"L",hash:{},data:o}))+'</label>\n        <select class="form-control taskLogStatus">\n          <option value="">Select status</option>\n          <option value="SUCCESS">SUCCESS</option>\n          <option value="FAILURE">FAILURE</option>\n        </select>\n      </div>\n\n      <div class="form-group source-group">\n        <label for="taskLogParams" class="control-label">'+r(s(n(688)).call(i,"_task_log_params",{name:"L",hash:{},data:o}))+'</label>\n        <input id="taskLogParams" type="text" class="form-control taskLogParams"\n          placeholder="Separated comma values (Ex: val1,val2)">\n      </div>\n    </div>\n\n  </div>\n  <div class="row">\n    <div class="col-sm-12" style="margin-bottom: 15px;">\n      <button class="btn btn-primary btnSearchLogs" style="width: 150px;">Search</button>\n    </div>\n  </div>\n\n  <div class="row">\n    <div class="col-sm-12">\n      <table class="table table-hover table-condensed dataTable dataTable-scroll-x etlTasks dataTable-nosort">\n        <thead>\n          <tr>\n            <th width="15%">'+r(s(n(688)).call(i,"_task",{name:"L",hash:{},data:o}))+'</th>\n            <th width="10%">'+r(s(n(688)).call(i,"_date",{name:"L",hash:{},data:o}))+'</th>\n            <th width="40%">'+r(s(n(688)).call(i,"_task_log_params",{name:"L",hash:{},data:o}))+'</th>\n            <th width="10%">'+r(s(n(688)).call(i,"_status",{name:"L",hash:{},data:o}))+'</th>\n            <th width="10%">'+r(s(n(688)).call(i,"_watch_log",{name:"L",hash:{},data:o}))+'</th>\n          </tr>\n        </thead>\n        <tbody>\n\n        </tbody>\n      </table>\n    </div>\n\n\n    <div class="row text-center loading" style="display: none;">\n      <i class="fa fa-spinner fa-spin fa-2x fa-fw"></i>\n    </div>\n  </div>\n\n</form>'},useData:!0})},2138:function(a,t,n){var e=n(690);a.exports=(e.default||e).template({1:function(a,t,n,e,s){var l,o,i=null!=t?t:a.nullContext||{},r=n.helperMissing,d="function",c=a.escapeExpression;return'<tr schedule-task-log-id="'+c(typeof(o=null!=(o=n.id||(null!=t?t.id:t))?o:r)===d?o.call(i,{name:"id",hash:{},data:s}):o)+'" data-sortable="false" '+(null!=(l=n.if.call(i,null!=t?t.newSession:t,{name:"if",hash:{},fn:a.program(2,s,0),inverse:a.noop,data:s}))?l:"")+">\n  <td>\n    <span>"+c(a.lambda(null!=(l=null!=t?t.periodic_task:t)?l.name:l,t))+"</span>\n  </td>\n  <td>\n    <span>"+c(typeof(o=null!=(o=n.created_at||(null!=t?t.created_at:t))?o:r)===d?o.call(i,{name:"created_at",hash:{},data:s}):o)+"</span>\n  </td>\n  <td>\n    <span>"+c(typeof(o=null!=(o=n.jsonParams||(null!=t?t.jsonParams:t))?o:r)===d?o.call(i,{name:"jsonParams",hash:{},data:s}):o)+'</span>\n  </td>\n  <td>\n    <span class="label label-'+c(typeof(o=null!=(o=n.statusClass||(null!=t?t.statusClass:t))?o:r)===d?o.call(i,{name:"statusClass",hash:{},data:s}):o)+'">'+c(typeof(o=null!=(o=n.state||(null!=t?t.state:t))?o:r)===d?o.call(i,{name:"state",hash:{},data:s}):o)+'</span>\n  </td>\n  <td>\n    <button class="btn showLog"><i class="fa fa-eye"></i></button>\n  </td>\n</tr>\n\n'},2:function(a,t,n,e,s){return' class="label-grey-3" '},compiler:[7,">= 4.0.0"],main:function(a,t,n,e,s){var l;return null!=(l=n.each.call(null!=t?t:a.nullContext||{},null!=t?t.data:t,{name:"each",hash:{},fn:a.program(1,s,0),inverse:a.noop,data:s}))?l:""},useData:!0})},683:function(a,t,n){"use strict";(function(e){var s;void 0===(s=function(){return e.Controller.extend({name:"showModal",show:function(a){Promise.all([n.e(2),n.e(118)]).then(function(){var t=[n(701)];(function(t){(new t).render(a)}).apply(null,t)}).catch(n.oe)}})}.apply(t,[]))||(a.exports=s)}).call(this,n(694))}}]);