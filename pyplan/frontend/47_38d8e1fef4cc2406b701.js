/*! Copyright Novix S.A. 2019. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{1154:function(t,e,a){"use strict";(function(i,n,r){var o,d,s=a(18);function l(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}o=[a(702),a(706),a(1450)],void 0===(d=function(t,e,o){var d,h=i.View.extend((l(d={el:n("#main"),menuInitiated:!1,editionModeInitiated:!1,dashboardModels:[],render:function(e,a){this.dashboardId=e;var i=this;if(this.dashboardModels.push(this.options.dashboardModel),this.dashboardController=new t,r(),1===n(".tabs-area .dash-tabs").length)return!1;function r(){var t=!!event&&n(event.currentTarget).hasClass("reports-view");if(event&&(event.target===window||t)){n(".tabs-area").show();var e=n(".tabs-area .toolbar").width(),a=(n(".nav-tabs").width(),n(".pagination").width()),r=n("#left").width();n(".nav-tabs").width(n(window).width()-e-a-r-100),setTimeout(function(){i.doAdapt()},350)}}this.refreshDashboardTabs(a),n(window).resize(r)},reloadDashboard:function(t,e){var a=this.getModel().getItemsModel();n.each(a,function(t,e){n(e.tagId).trigger("removeItemView")}),this.getModel().removeAllItemsModel();var i=this;this.getModel().getDashboard(t,function(t){i.refreshDashboardName(t),i.getModel().setNodeOwner(t.nodeOwner),i.parseDashboard(t,e),i.getParent().find("div.breadcrumbs2").show(),i.checkShared(!1),i=null})},refreshDashboardName:function(t){if(t){var e=t.dashboardId,a=t.name;this.dashboardName=a,n("span[data-rel='dashboard-"+e+"']").text(a),n("#topMenuBar li a[rel='dashboard-"+e+"']").text(a),n(".dash-tabs li a[data-rel='"+e+"']").text(a)}},getModel:function(){var t=this.getParent().find(".dash-tabs li a.active").attr("data-rel"),e=null;return n.each(this.dashboardModels,function(a,i){parseInt(i.attributes.dashId)===parseInt(t)&&(e=i)}),e},checkShared:function(t,e){if(this.getModel().attributes.imOwner)e||(n(".tabs-area").find(".toolbar .btnEdit").show(),n(".tabs-area").find(".toolbar .btnShare").show(),n(".tabs-area").find(".toolbar .shared-message").html(""));else{n(".tabs-area").find(".toolbar .btnEdit").hide(),n(".tabs-area").find(".toolbar .btnShare").hide(),t.sharedBy?n(".tabs-area").find(".toolbar .shared-message").html((0,s.translate)("full_shared_by")+": "+t.sharedBy):n(".tabs-area").find(".toolbar .shared-message").html((0,s.translate)("Is shared"));var a=this;this.getParent().on("refreshImageDashboard",function(t,e){a.reloadDashboard(e)})}},addHandlers:function(){n(".tabs-area .dash-tabs").on("click",'li a:not(".moreBtn")',function(){event.preventDefault(),n(".tabs-area .dash-tabs ul.-secondary li:visible").length>=1&&n(".tabs-area .dash-tabs .moreBtn").click(),n(".tabs-area .nav-tabs li").find("a").removeClass("active"),n(this).addClass("active");var t=n(this).attr("data-key"),e=n(this).attr("data-rel");"true"!==n(this).attr("data-opened")&&(n(".dashboard-titles li a").attr("data-opened",!1),n(this).attr("data-opened",!0),Promise.resolve().then(function(){var t=[a(702)];(function(t){(new t).showEmbeddableDashboard(e,null,"Loading...",!1,!1,null)}).apply(null,t)}).catch(a.oe)),Promise.resolve().then(function(){var e=[a(684)];(function(e){(new e).selectTask(t)}).apply(null,e)}).catch(a.oe)}),n(".tabs-area .dash-tabs").on("click","li i",function(){var e=n(this).closest("li").find("a").attr("data-key"),i=n(this).closest("li").find("a").attr("data-rel");t.dashboardModels=n.grep(t.dashboardModels,function(t){return t.attributes.dashId!=i}),Promise.resolve().then(function(){var i=[a(684)];(function(a){(new a).removeTask(e),t.refreshDashboardTabs()}).apply(null,i)}).catch(a.oe)}),n(document).off("contextmenu",".tabs-area li a"),n(document).on("contextmenu",".tabs-area li a",function(e){return t.showTabContextMenu(n(this),e),!1});var t=this;this.getParent().find("div.toolbar button.btnEdit").on("click",n.proxy(function(){t.editionModeInitiated?t.refreshMode(!0):(t.editionModeInitiated=!0,t.refreshMode(!0))},this)),this.getParent().find("div.toolbar button.btnAdd").on("click",function(){t.addNewWidget(t)}),this.getParent().find("div.toolbar button.btnShow").on("click",n.proxy(function(){this.refreshMode(!1),this.checkFromDiagram(this.getModel().attributes),setTimeout(function(){t.saveDashboard(),t.doAdapt()},200)},this)),this.getParent().find("div.toolbar button.btnCancel").on("click",function(){t.getParent().find("div.toolbar button.btnShow").hide(),t.getParent().find("div.toolbar button.btnCancel").hide(),t.getParent().find("div.toolbar button.btnAdd").hide(),t.getParent().find("div.sure_cancel_dashboard").show(),t.getParent().find("div.toolbar button.btnGoCancel").show(),t.getParent().find("div.toolbar button.btnCancelCancel").show()}),this.getParent().find("div.toolbar button.btnGoCancel").on("click",function(){var e=t.getParent().find("a.active").attr("data-rel");t.getParent().find("div.sure_cancel_dashboard").hide(),t.refreshMode(!1),t.getGrid().addClass("grid-stack-autoposition"),n('[data-rel="dashboard-'+e+'"]').trigger("reloadDashboard")}),this.getParent().find("div.toolbar button.btnCancelCancel").on("click",function(){t.getParent().find("div.sure_cancel_dashboard").hide(),t.getParent().find("div.toolbar button.btnShow").show(),t.getParent().find("div.toolbar button.btnCancel").show(),t.getParent().find("div.toolbar button.btnAdd").show()}),this.getParent().find("div.toolbar button.btnShare").on("click",n.proxy(function(){var t=this.getParent().find("a.active").attr("data-rel");(0,s.haveAccess)("share_dashboard")?a.e(49).then(function(){var e=[a(1115)];(function(e){(new e).showSharer(t)}).apply(null,e)}).catch(a.oe):a.e(17).then(function(){var t=[a(685)];(function(t){(new t).show({title:"WARNING!",text:(0,s.translate)("share_dashboard_access_denied"),notifyType:"error"})}).apply(null,t)}).catch(a.oe)},this)),this.getParent().find("div.toolbar button.btnScenarios").on("click",function(){a.e(30).then(function(){(function(e){var i=[a(921)];(function(a){var i={nodeList:[]},r=[];n.each(n(".dash-tabs li a"),function(e,a){var i=n(this).attr("data-rel");r=n('div.mainTask[data-rel="dashboard-'+i+'"]').triggerHandler("getModel",[r]),h=t.getModel().getItemModel(i)});var o=[];n.each(r,function(t,e){n.each(e.getItemsModel(),function(t,e){o.push(e)})});var d=["indexlist","formnode","selector","button","objectItem","map","indicator"];"cubengine"==__currentSession.modelInfo.engine&&(d=["indexlist","formnode","selector","button","objectItem","map"]),n.each(o,function(t,a){if(a&&a.currentNodeId)if(a.currentResult&&-1!==e.inArray(a.currentResult.itemType,d));else{var r=a.currentNodeId;a.currentResult&&a.currentResult.nodeProperties&&a.currentResult.nodeProperties.originalId&&(r=a.currentResult.nodeProperties.originalId),a.pivotTable&&a.pivotTable.metadata&&a.pivotTable.metadata.nodeProperties&&a.pivotTable.metadata.nodeProperties.originalId&&(r=a.pivotTable.metadata.nodeProperties.originalId),0===n.grep(i.nodeList,function(t){return t.id===r}).length&&i.nodeList.push({id:r,name:a.currentResult&&a.currentResult.itemProperties&&a.currentResult.itemProperties.title?a.currentResult.itemProperties.title.text:a.currentNodeId})}}),(new a).show(i)}).apply(null,i)}).call(this,a(1))}).catch(a.oe)}),this.getParent().find("div.toolbar button.btnDataSnapshot").on("click",function(){a.e(30).then(function(){var t=[a(921)];(function(t){(new t).showDataSnapshot()}).apply(null,t)}).catch(a.oe)}),this.getParent().find("div.toolbar button.btnCopy").on("click",function(){var e=t.getParent().find("a.active").first().attr("data-rel"),i=t.getParent().find("a.active").first().text();t.dashboardController.showCopyDashboard(e,i,function(e,i){Promise.resolve().then(function(){var r=[a(702)];(function(a){n("#model-summary").trigger("fullRefresh"),t.dashboardController.showDashboard(e,-1,i)}).apply(null,r)}).catch(a.oe)})}),this.getParent().find("div.toolbar button.btnRefresh").on("click",n.proxy(function(){Promise.resolve().then(function(){var e=[a(219)];(function(e){(new e).executeForRefresh(function(e){var a=[];t.noQuery&&n.each(t.noQuery,function(t,e){n.each(e.rel,function(t,e){a.push(e)})}),t.getModel().initializeDashboardQuery(t.noQuery);var i=t.getModel().getItemsModel();n.each(i,function(t,e){a.indexOf(e.currentNodeId)>=0||n(e.tagId).trigger("refreshItemDash")})})}).apply(null,e)}).catch(a.oe)},this)),this.getParent().find("div.toolbar button.btnComments").on("click",function(){var e=t.getParent().find("a.active").attr("data-rel");Promise.resolve().then(function(){var i=[a(702)];(function(a){(new a).showDashboardComments({dashboardId:e,parent:t.getParent()})}).apply(null,i)}).catch(a.oe)}),this.getParent().find("div.toolbar button.btnPrint").on("click",function(){var e=t.getParent().find("a.active").attr("data-rel");Promise.resolve().then(function(){var t=[a(751)];(function(t){(new t).printDashboard(e)}).apply(null,t)}).catch(a.oe)}),this.getParent().find(".main-fullscreen button[data-rel='close-screen']").on("click",function(){var e=n(this).closest(".main-fullscreen").find(".item-area").parent(),a="#"+e.attr("data-parent"),i=(e.attr("data-parent"),n(a)),r=n(this).closest(".main-fullscreen"),o=(i.offset(),e.attr("data-orignal-w")),d=e.attr("data-orignal-h"),s=e.attr("data-orignal-y"),l=e.attr("data-orignal-x"),h=n(this);r.animate({top:s+"px",left:l+"px",width:o,height:d},{done:function(){n.wrapper.append(e.detach()),r.hide(),h.show(),t.updateSizes(),t.getModel().getItemModel(a).onEndNormalScreenAnimation()}}),t.getModel().getItemModel(a).updateSize(o,d,!0)}),this.getParent().find(".report-navigator a").on("click",function(){event.preventDefault();var e=n(this).attr("data-id"),a=n(this).attr("title");e&&(t.dashboardController.showDashboard(e,-1,a),t.getNavigator(e))})},getCurrentViewPort:function(){var t;return this.isBreakpoint("xs")?t="xs":this.isBreakpoint("sm")?t="sm":this.isBreakpoint("md")?t="md":this.isBreakpoint("lg")&&(t="lg"),t},checkFromDiagram:function(t){""!==t.node&&null!==t.node?(n(".tabs-area").find(".toolbar .btnCopy").hide(),n(".tabs-area").find(".toolbar .btnShare").hide()):n(".tabs-area").find(".toolbar .btnCopy").show()},addNewWidget:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;(h=t).fromAddButton=!0;var r=this.getGrid().data("gridstack"),o=0;r.grid.nodes.length>0&&(o=Math.max.apply(Math,r.grid.nodes.map(function(t){return t.y+t.height})));var d=12,s=7;switch(this.getCurrentViewPort()){case"xs":d=2,s=3;break;case"sm":case"md":d=6,s=4;break;case"lg":d=12}var l={x:0,y:o,width:d,height:s};e&&(l=e);var h=this;i&&"empty"!=i.itemType?a.e(0).then(function(){var t=[a(722)];(function(t){var e=new t({model:h.getModel()});e.setElement(n("div.grid-stack")),e.currentResult=n.extend(!0,{},i.currentResult),e.grid=r,e.dashboardModel=h.getModel(),e.loadingDashboard=!0,e.currentResult.itemId=n.uuid(),e.currentResult.itemType="table"==i.currentResult.itemType?"columnchart":"table",e.currentResult.itemProperties.bottomTotal=!1,e.currentResult.itemProperties.rightTotal=!1,e.currentResult.x=l.x,e.currentResult.y=l.y,e.currentResult.width=l.width,e.currentResult.height=l.height,h.getModel().addItemToModel(e),e.createNewView(e.currentResult,!1)}).apply(null,t)}).catch(a.oe):Promise.resolve().then(function(){var t=[a(702)];(function(t){(new t).getEmptyContent(h.getModel(),function(t){t.setElement(h.getGrid()),t.model=h.getModel(),t.grid=r,t.currentResult=l,t.itemType="empty",t.currentResult.itemType="empty",t._applyItemId(l,null);t.render(null,null,!0),h.getModel().addItemToModel(t),t.setEditMode(h.getModel().editMode)})}).apply(null,t)}).catch(a.oe),h.getModel().setStateModified(!0)},refreshMode:function(t){var e=this;e.getModel().editMode=t,this.getParent().find("div.toolbar button").hide(),this.getGrid().data("gridstack").setStatic(!t);var i=this.getModel().getItemsModel();n.each(i,function(e,a){a.setEditMode(t)}),t?(this.getParent().find(".dash-tabs").hide(),this.getGrid().addClass("editing"),this.getParent().find("div.toolbar button.btnShow").show(),this.getParent().find("div.toolbar button.btnCancel").show(),this.getParent().find("div.toolbar button.btnAdd").show(),this.getGrid().removeClass("grid-stack-autoposition")):(this.getParent().find(".dash-tabs").show(),this.getGrid().removeClass("editing"),this.getParent().find("div.toolbar button").show(),this.getParent().find("div.toolbar button.btnShow").hide(),this.getParent().find("div.toolbar button.btnCancel").hide(),this.getParent().find("div.toolbar button.btnAdd").hide()),a.e(65).then(function(){var t=[a(731)];(function(t){(new t).list(null,function(t){e.getModel().setStyleLibraries(t)})}).apply(null,t)}).catch(a.oe)},sortWidgets:function(t,e){return t.currentResult.y<e.currentResult.y?-1:t.currentResult.y>e.currentResult.y?1:t.currentResult.x<e.currentResult.x?-1:t.currentResult.x>e.currentResult.x?1:0},saveDashboard:function(){var t=this,e={},a=[],i=this.getModel().getItemsModel(),r=[],o=[];n.each(i,function(t,e){var a=e.getRelatedNoQuery();a&&a.length>0&&r.push({node:e.currentNodeId,rel:a});var i=e.getStylesUsed();i&&(o=o.concat(i))}),e.noQuery=r,i.sort(this.sortWidgets);var d=0;n.each(i,function(t,i){e={};var r=i.tagId;if(i){e.index=d,e.nodeId=i.currentNodeId,e.itemId=i.itemId;var o=i.grid.grid.getNodeDataByDOMEl(n(r));e.x=o.x,e.y=o.y,e.width=o.width,e.height=o.height,e.itemProperties=i.currentResult.itemProperties,e.itemType=i.currentResult.itemType,e.objectType=i.currentResult.objectType,i.currentResult&&(e.itemType=i.currentResult.itemType,"objectItem"==e.itemType&&(e.objectType=i.currentResult.objectType),e.rows=i.currentResult.rows,e.columns=i.currentResult.columns,e.dims=i.currentResult.dims,e.itemProperties=i.currentResult.itemProperties),a.push(e)}d++});var s=t.getParent().find(".dash-tabs li a.active").attr("data-rel");this.getModel().getDashboard(s,function(e){var r,d=t.getModel().getStateModified();switch(r=e.definition?e.definition:{},t.getCurrentViewPort()){case"xs":r.definitionSmall=a,d&&(delete r.definitionLarge,delete r.definitionMedium);break;case"sm":case"md":r.definitionMedium=a,d&&(delete r.definitionLarge,delete r.definitionSmall);break;case"lg":r.definitionLarge=a,d&&(delete r.definitionMedium,delete r.definitionSmall)}t.getModel().updateDefinition(s,r,o,function(){n.each(i,function(t,e){e.onSaveDashboard()}),t.getModel().setStateModified(!1),t=null})})},recalcWidgets:function(t,e){var a,i=this.getCurrentViewPort(),n=t;switch(e){case"xs":a=r.map(n,function(t){var e,a=1===t.width||2===t.width?t.width:2;e=a>=2?0:0===t.x||1===t.x?t.x:0;var i=Object.assign({},t);return i.width=a,i.x=e,i},this);break;case"sm":case"md":var o=2;"xs"===i&&(o=3);a=r.map(n,function(t){var e=t.width*o;e=Math.floor(e);var a=t.x*o;a=Math.floor(a);var i=Object.assign({},t);return i.width=e,i.x=a,i},this);break;case"lg":o=2;"xs"===i&&(o=6),a=r.map(n,function(t){var e=t.width*o;e=Math.floor(e);var a=t.x*o;a=Math.floor(a);var i=Object.assign({},t);return i.width=e,i.x=a,i},this)}return a}},"getCurrentViewPort",function(){var t;return this.isBreakpoint("xs")?t="xs":this.isBreakpoint("sm")?t="sm":this.isBreakpoint("md")?t="md":this.isBreakpoint("lg")&&(t="lg"),t}),l(d,"isBreakpoint",function(t){return n(".device-"+t).is(":visible")}),l(d,"showTabContextMenu",function(t,e){var i={_me:{name:(0,s.translate)("close")},_all:{name:(0,s.translate)("close_all")},_others:{name:(0,s.translate)("close_all_but_this")}};n.contextMenu("destroy",".tabs-area"),n.contextMenu({selector:".tabs-area",callback:function(e,i){switch(e){case"_me":t.closest("li").find("i").click();break;case"_all":case"_others":var r=t.attr("data-key");"_all"==e&&(r="_123123_"),Promise.resolve().then(function(){var i=[a(684)];(function(a){var i=new a,o=[];t.closest("ul.dash-tabs").find("li a:not(.moreBtn)").each(function(t,e){n(e).attr("data-key")!=r&&o.push(n(e).attr("data-key"))}),o.length>0&&n.each(o,function(t,a){"_all"==e?i.removeTask(a,!1):(i.selectTask(r),i.removeTask(a,!0))})}).apply(null,i)}).catch(a.oe)}},items:i,events:{hide:function(t){n.contextMenu("destroy",".tabs-area")}},zIndex:0}),n(".tabs-area").contextMenu({x:e.clientX,y:e.clientY})}),l(d,"refreshDashboardTabs",function(t){var e=this,a=!1,i=[];window.location.href.indexOf("/#shared/")>0&&(a=!0),a?"dashboard"===t?(n(".dashboardTask.new").each(function(t,e){var a=n(e).attr("data-rel"),r=a.split("-")[1],o=n("#topMenuBar ul li a[rel='"+a+"']").text();o||(o=n(e).attr("dash-title")),i.push({id:r,key:a,title:o,closeBtn:!1})}),e.drawTabs(i)):this.options.dashboardModel.getNavigator({dashboardId:this.dashboardId},function(t){t&&t.list.length>0&&n.each(t.list,function(t,e){i.push({id:e.id,key:"dashboard-"+e.id,title:e.name,closeBtn:!1})}),e.drawTabs(i)}):(n(".dashboardTask.new").each(function(t,e){var a=n(e).attr("data-rel"),r=a.split("-")[1],o=n("#topMenuBar ul li a[rel='"+a+"']").text();o||(o=n(e).attr("dash-title")),i.push({id:r,key:a,title:o,closeBtn:!0})}),e.drawTabs(i))}),l(d,"drawTabs",function(t){var e=this;n(".tabs-area").remove();var a,i=n(".tabs-area");if(i.empty(),i.hide(),t.length>0){var r=o(t);n(r).insertBefore(n(n(".mainTask.dashboardTask")[0])),i.show()}if(window.location.href.indexOf("/#shared/")>0)a=n('.tabs-area .nav-tabs li a[data-rel="'+this.dashboardId+'"]');else{var d=n("#currentTask").attr("data-rel");a=n('.tabs-area .nav-tabs li a[data-key="'+d+'"]'),this.dashboardId=a.attr("data-rel")}a.addClass("active"),a.attr("data-opened",!0),a.click();n(".tabs-area .nav-tabs li:first a").attr("data-rel");this.getNavigator(this.dashboardId);var s=n(".nav-tabs"),l=s.find(".-primary");s.find(".-primary > li:not(.-more)");s.addClass("--jsfied"),l.append('\n        <li class="-more">\n          <a class="moreBtn" aria-haspopup="true" aria-expanded="false">\n            More <span>&darr;</span>\n          </a>\n          <ul class="-secondary">\n            '.concat(l.html(),"\n          </ul>\n        </li>\n      "));s.find(".-secondary").find("li"),s.find("li");var h=n("li.-more").find(".moreBtn");h.on("click",function(t){t.preventDefault(),s.toggleClass("--show-secondary"),h.attr("aria-expanded",s.hasClass("--show-secondary"))}),this.addHandlers(),this.doAdapt(),n(".tabs-area .toolbar").on("pendingRefresh",function(t,a){var i,r=e.getParent().find(".dash-tabs li a");n.each(r,function(t,r){i=n(r).attr("data-rel");n.each(e.dashboardModels,function(t,e){parseInt(e.attributes.dashId)===parseInt(i)&&n.each(e.getItemsModel(),function(t,e){e.currentNodeId==a.nodeId&&n(r).attr("pending-refresh",!0)})})})}),n(".tabs-area .toolbar").on("checkIfPendingRefresh",function(t,a){"true"===e.getParent().find(".dash-tabs li a.active").attr("pending-refresh")&&(console.log("refrescando!"),n(".tabs-area .toolbar .btnRefresh").click(),e.getParent().find(".dash-tabs li a.active").attr("pending-refresh",!1))})}),l(d,"getNavigator",function(t){var e=this,a=this.getModel();a&&(a.getNavigator({dashboardId:t},function(a){a&&(a.priorId>0&&e.getParent().find(".btnNavigatorPrior").attr("data-id",a.priorId).attr("title",a.priorName).closest("li").removeClass("disabled"),a.nextId>0&&e.getParent().find(".btnNavigatorNext").attr("data-id",a.nextId).attr("title",a.nextName).closest("li").removeClass("disabled")),e.getParent().find(".nav-tabs li a").removeClass("active"),e.getParent().find('.nav-tabs li a[data-rel="'+t+'"]').addClass("active")}),window.location.href.indexOf("/#shared/")>0&&n(".report-navigator").hide())}),l(d,"doAdapt",function(){n(".tabs-area").show();var t=n(".tabs-area .toolbar").width(),e=(n(".nav-tabs").width(),n(".pagination").width()),a=n("#left").width();n(".nav-tabs").width(n(window).width()-t-e-a-100);var i=n(".nav-tabs"),r=i.find(".-primary"),o=i.find(".-primary > li:not(.-more)"),d=i.find(".-secondary").find("li"),s=i.find("li"),l=n("li.-more"),h=l.find(".moreBtn");s.each(function(t,e){e.classList.remove("--hidden")});var c=h.length>0?h.width():0,u=[],b=r.length>0?r.width():0;o.each(function(t,e){b>=c+e.offsetWidth?c+=e.offsetWidth:(e.classList.add("--hidden"),u.push(t))}),u.length?d.each(function(t,e){u.includes(t)||e.classList.add("--hidden")}):(l.addClass("--hidden"),i.removeClass("--show-secondary"),h.attr("aria-expanded",!1)),n(".mainTask:visible").hasClass("dashboardTask")?n(".tabs-area").show():n(".tabs-area").hide()}),l(d,"getParent",function(){return n(".tabs-area")}),l(d,"getGrid",function(){var t=this.getParent().find("a.active").attr("data-rel");return n(".grid-dash-"+t)}),d));return h}.apply(e,o))||(t.exports=d)}).call(this,a(218),a(1),a(220))},1449:function(t,e,a){var i=a(690);t.exports=(i.default||i).template({1:function(t,e,a,i,n){return" from-external "},compiler:[7,">= 4.0.0"],main:function(t,e,a,i,n){var r,o,d=null!=e?e:t.nullContext||{},s=a.helperMissing,l=t.escapeExpression;return'<div\n  class="container-fluid mainTask full-horizontal dashboardTask new hideClose '+(null!=(r=a.if.call(d,null!=(r=null!=e?e.extraOptions:e)?r.external:r,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n}))?r:"")+'"\n  data-rel="dashboard-'+l("function"==typeof(o=null!=(o=a.id||(null!=e?e.id:e))?o:s)?o.call(d,{name:"id",hash:{},data:n}):o)+'" dash-name="'+l("function"==typeof(o=null!=(o=a.dashTitle||(null!=e?e.dashTitle:e))?o:s)?o.call(d,{name:"dashTitle",hash:{},data:n}):o)+'" data-type="tab-content">\n\n\n\n  <div class="breadcrumbs2 nodisplay">\n  </div>\n\n  <div class="device-xs visible-xs"></div>\n  <div class="device-sm visible-sm"></div>\n  <div class="device-md visible-md"></div>\n  <div class="device-lg visible-lg"></div>\n  <div class="device-xl visible-xl"></div>\n\n  <div style="display: none;">\n    <span>Number of Columns:</span> <span id="grid-size"></span>\n  </div>\n\n\n\n  <div class="grid-stack grid-dash-'+l("function"==typeof(o=null!=(o=a.id||(null!=e?e.id:e))?o:s)?o.call(d,{name:"id",hash:{},data:n}):o)+' dashboard-area main-pane">\n  </div>\n\n\n  <div class="main-fullscreen" style="display: none; position:absolute;">\n    <div class="item-toolbar-view">\n      <button class="btn btn-small" data-rel="close-screen">\n        <i class="fa fa-arrows-alt"></i>\n      </button>\n    </div>\n  </div>\n</div>'},useData:!0})},1450:function(t,e,a){var i=a(690);function n(t){return t&&(t.__esModule?t.default:t)}t.exports=(i.default||i).template({1:function(t,e,i,r,o){return'            <button class="btn btnEdit" title="'+t.escapeExpression(n(a(688)).call(null!=e?e:t.nullContext||{},"edit_dashboard",{name:"L",hash:{},data:o}))+'">\n                <i class="fa fa-pencil-square-o"></i>\n            </button>\n            <button class="btn btnShow nodisplay">\n                <i class="fa fa-check"></i>\n            </button>\n            <button class="btn btnCancel nodisplay">\n                <i class="fa fa-times"></i>\n            </button>\n            <button class="btn btnAdd nodisplay">\n                <i class="fa fa-plus"></i>\n            </button>\n'},3:function(t,e,a,i,n){return"            "},5:function(t,e,i,r,o){return'\n            \x3c!--button class="btn btnShare" title="'+t.escapeExpression(n(a(688)).call(null!=e?e:t.nullContext||{},"share",{name:"L",hash:{},data:o}))+'">\n                <i class="fa fa-share-square"></i>\n            </button--\x3e\n'},7:function(t,e,i,r,o){return'            \x3c!-- button class="btn btnScenarios" title="'+t.escapeExpression(n(a(688)).call(null!=e?e:t.nullContext||{},"scenario_manager",{name:"L",hash:{},data:o}))+'">\n            <i class="fa fa-database"></i>\n            </button --\x3e\n'},9:function(t,e,i,r,o){return'            <button class="btn btnCopy" title="'+t.escapeExpression(n(a(688)).call(null!=e?e:t.nullContext||{},"copy_dashboard",{name:"L",hash:{},data:o}))+'">\n                <i class="fa fa-files"></i>\n            </button>\n'},11:function(t,e,a,i,n){return""},13:function(t,e,i,r,o){var d,s=t.lambda,l=t.escapeExpression;return'            <li>\n                <a href="#" data-rel="'+l(s(null!=e?e.id:e,e))+'" data-key="'+l(s(null!=e?e.key:e,e))+'" title="'+l(s(null!=e?e.title:e,e))+'">'+l(s(null!=e?e.title:e,e))+"</a>\n"+(null!=(d=n(a(689)).call(null!=e?e:t.nullContext||{},null!=e?e.closeBtn:e,"==",!0,{name:"ifCond",hash:{},fn:t.program(14,o,0),inverse:t.noop,data:o}))?d:"")+"            </li>\n"},14:function(t,e,a,i,n){return'                <i class="fa fa-close" />\n'},compiler:[7,">= 4.0.0"],main:function(t,e,i,r,o){var d,s=null!=e?e:t.nullContext||{},l=t.escapeExpression;return'<div class="tabs-area">\n\n    <div class="toolbar" style="float: left; background: #eee; padding-right:2px;">\n        <div class="btn-group">\n'+(null!=(d=n(a(698)).call(s,"add_dashboard",{name:"haveAccess",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o}))?d:"")+'            <button class="btn btnRefresh" title="'+l(n(a(688)).call(s,"refresh_dashboard",{name:"L",hash:{},data:o}))+'">\n                <i class="fa fa-refresh"></i>\n            </button>\n\n'+(null!=(d=n(a(698)).call(s,"view_report",{name:"haveAccess",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o}))?d:"")+" "+(null!=(d=n(a(698)).call(s,"share_dashboard",{name:"haveAccess",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o}))?d:"")+(null!=(d=n(a(698)).call(s,"MANAGESCENARIOS",{name:"haveAccess",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o}))?d:"")+(null!=(d=n(a(698)).call(s,"add_dashboard",{name:"haveAccess",hash:{},fn:t.program(9,o,0),inverse:t.noop,data:o}))?d:"")+'\n            \x3c!-- button class="btn btnPrint" title="'+l(n(a(688)).call(s,"print_dashboard",{name:"L",hash:{},data:o}))+'">\n            <i class="fa fa-print"></i>\n            </button --\x3e\n\n'+(null!=(d=n(a(698)).call(s,"list_dashboardcomments",{name:"haveAccess",hash:{},fn:t.program(11,o,0),inverse:t.noop,data:o}))?d:"")+'\n            \x3c!-- button class="btn btnGeneralConfig" title="'+l(n(a(688)).call(s,"comments",{name:"L",hash:{},data:o}))+'">\n            <i class="fa fa-cog"></i>\n            </button --\x3e\n\n            <div class="sure_cancel_dashboard nodisplay">\n                <span>'+l(n(a(688)).call(s,"sure_cancel_save_dashboard",{name:"L",hash:{},data:o}))+'</span>\n                <button class="btn btn-small btn-red btnGoCancel">'+l(n(a(688)).call(s,"yes",{name:"L",hash:{},data:o}))+'</button>\n                <button class="btn btn-small btn-grey btnCancelCancel">'+l(n(a(688)).call(s,"no",{name:"L",hash:{},data:o}))+'</button>\n            </div>\n\n            <a class="btn btn-default" id="save-widgets" href="#" style="display: none;">Save</a>\n\n        </div>\n        <span class="shared-message"></span>\n    </div>\n\n    <nav class="nav-tabs" style="float: left;">\n        <ul class="dash-tabs -primary nodisplay">\n\n'+(null!=(d=i.each.call(s,e,{name:"each",hash:{},fn:t.program(13,o,0),inverse:t.noop,data:o}))?d:"")+'\n        </ul>\n    </nav>\n\n    <ul class="pagination pagination-sm report-navigator">\n        <li class="disabled">\n            <a href="#" class="btnNavigatorPrior">\n                <i class="fa fa-chevron-left"></i>\n            </a>\n        </li>\n        <li class="disabled">\n            <a href="#" class="btnNavigatorNext">\n                <i class="fa fa-chevron-right"></i>\n            </a>\n        </li>\n    </ul>\n</div>'},useData:!0})},881:function(t,e,a){"use strict";(function(i,n,r,o){var d,s,l=a(18);d=[a(702),a(706),a(1449),a(1154)],void 0===(s=function(t,e,d,s){return i.View.extend({el:n("#main"),menuInitiated:!1,editionModeInitiated:!1,fromExternal:!1,initialize:function(){},render:function(i,o,h,c,u){this.currentDashboardId=i,this.keyView="div.mainTask[data-rel='dashboard-"+i+"']",c&&c.external&&(this.fromExternal=!0);var b={id:i,extraOptions:c};this.dashboardModel=new e({dashId:i,dashboardViewList:[],nodeOwner:"",imOwner:u,editMode:!1,extraOptions:c}),this.dashboardController=new t;var f=this,g=d(b);this.$el.append(g),this.dashboardTabs=new s({dashboardModel:this.dashboardModel}),this.dashboardTabs.render(i),this.reloadDashboard(i,h),f.fromAddButton=!1,this.currentViewPort=this.getCurrentViewPort();var m=12;switch(this.currentViewPort){case"xs":m=2;break;case"sm":case"md":m=6;break;case"lg":m=12}var v={float:!1,staticGrid:!0,verticalMargin:2,cellHeight:65,disableOneColumnMode:!0,width:m,resizable:{handles:"sw, w, se, e, s"},draggable:{handle:".widgetTitle",scroll:!0}};f.getGrid().removeClass("grid-stack-12").removeClass("grid-stack-6"),f.getGrid().gridstack(v),f.grid=f.getGrid().data("gridstack"),n(window).on("resize.updateSizes",function(t){n(".mainTask.dashboardTask:visible").length>=1&&f.updateSizes(t)}),this.updateSizes(),this.addHandlers(),this.addGenericHandlers(),n(this.keyView).on("reloadDashboard",function(){f.grid.removeAll(),f.reloadDashboard(i,!1)}),this.getGrid().on("added",function(t,e){f.fromAddButton&&(f.afterAddWidget(),f.fromAddButton=!1)}).on("removed",function(t,e){}).on("gsresizestop",function(t,e){setTimeout(function(){var t=r(e).attr("id");f.afterChangeWidget(t);var a=f.dashboardModel.getItemModel("#"+t);a.updateSize(),n(".chartToolbar.popover").length>0&&a.addProperties(!0)},100)}).on("dragstop",function(t,e){setTimeout(function(){var e=r(t.target).attr("id");f.afterChangeWidget(e);var a=f.dashboardModel.getItemModel("#"+e);n(".chartToolbar.popover").length>0&&a.addProperties(!0)},100)}),this.getGrid().on("click",".clearWidget",function(t){if(n(t.target).closest(".grid-stack-item-content").find(".chartTypeSelector").length)return!1;a.e(3).then(function(){var e=[a(683)];(function(e){(new e).show({title:(0,l.translate)("clear_widget"),text:(0,l.translate)("sure_clear_widget"),buttons:[{title:(0,l.translate)("yes"),css:"primary",code:"yes"},{title:(0,l.translate)("no"),code:"no"}],callback:function(e){if("yes"==e){var i="#"+n(t.target).closest(".grid-stack-item").attr("id"),r=n(t.target).closest(".grid-stack-item").attr("id"),o=f.dashboardModel.getItemModel(i),d={x:o.currentResult.x,y:o.currentResult.y,width:o.currentResult.width,height:o.currentResult.height};f.dashboardModel.removeItemModel(o),f.grid.remove_widget(i),Promise.resolve().then(function(){var t=[a(702)];(function(t){(new t).getEmptyContent(f.dashboardModel,function(t){t.setElement(f.grid),t.model=f.dashboardModel,t.grid=f.grid,t.currentResult=d,t.itemType="empty",t.currentResult.itemType="empty",t._applyItemId(null,r),t.render(),f.dashboardModel.addItemToModel(t),t.setEditMode(f.dashboardModel.editMode)})}).apply(null,t)}).catch(a.oe)}}})}).apply(null,e)}).catch(a.oe)}),this.getGrid().on("click",".restoreWidget",function(t){var e=n(event.target).closest(".grid-stack-item");n(e).find(".restoreWidget").hide();var a=n(e).find(".grid-stack-item-content"),i=a.attr("data-orignal-w"),r=a.attr("data-orignal-h"),o=a.attr("data-orignal-x"),d=a.attr("data-orignal-y");e.animate({top:d,left:o,width:i,height:r},{done:function(){e.removeAttr("style"),f.dashboardModel.getItemModel("#"+e.attr("id")).updateSize(i,e.height()-28,!0),n("body").css("overflow-y","visible"),n("#"+e.attr("id")+"-fullscreenHelper").hide(),setTimeout(function(){window.scrollTo(0,n("#"+e.attr("id")).offset().top)},100)}})}),this.getGrid().on("click",".splitWidgetRight",function(t){var e=n(t.currentTarget).attr("graph");f.getGrid().find(".splitWidgetRight").removeAttr("graph"),f.getGrid().find(".splitWidgetBottom").removeAttr("graph"),parseInt(n(t.currentTarget).closest(".grid-stack-item").attr("data-gs-width"))>1&&f.splitWidget(t,"right",e)}),this.getGrid().on("click",".splitWidgetBottom",function(t){var e=n(t.currentTarget).attr("graph");f.getGrid().find(".splitWidgetRight").removeAttr("graph"),f.getGrid().find(".splitWidgetBottom").removeAttr("graph"),parseInt(n(t.currentTarget).closest(".grid-stack-item").attr("data-gs-height"))>1&&f.splitWidget(t,"bottom",e)}),this.getGrid().on("click",".removeWidget",function(t){var e=n(t.target).closest(".grid-stack-item").attr("data-gs-id");f.dashboardModel.getItemModel("#"+e).checkNodeOwner()||a.e(3).then(function(){var e=[a(683)];(function(e){(new e).show({title:(0,l.translate)("delete_widget"),text:(0,l.translate)("sure_delete_widget"),buttons:[{title:(0,l.translate)("yes"),css:"primary",code:"yes"},{title:(0,l.translate)("no"),code:"no"}],callback:function(e){"yes"==e&&f.removeWidget(t)}})}).apply(null,e)}).catch(a.oe)}),n(".clearGrid").on("click",function(){f.clearGrid()}),this.getGrid().on("click",".moreChartTypes",function(t){var e=n(event.target).closest(".grid-stack-item").attr("data-gs-id");f.moreChartTypesMenu(e)}),n(".dash-overlay").on("click",function(){f.closeToolbar()}),n("#save-widgets").on("click",function(){setTimeout(function(){f.saveDashboard()},200)}),this.clearGrid=function(){return this.grid.removeAll(),!0}.bind(this),this.getThis().on("refreshView",function(){f.getParent().find("div.toolbar button.btnRefresh").trigger("click")}),this.getThis().on("changeNumberFormat",function(t,e){f&&f.dashboardModel&&f.dashboardModel.applyNumberFormat(e)}),this.getThis().on("reevaluateNodesNeeded",function(t,e){f&&f.dashboardModel&&f.dashboardModel.reevaluateNodesNeededInThisDashboard(e)}),this.getThis().on("removeView",function(){f.onRemoveView()}),this.getThis().on("beforeRemoveView",function(t,e){f.onBeforeRemoveView(t,e)}),this.getParent().on("selectView",function(){n(".tabs-area .nav-tabs li a").removeClass("active"),n('.tabs-area .nav-tabs li a[data-rel="'+f.currentDashboardId+'"]').addClass("active"),f.updateSizes()})},updateSizes:function(t){var e=this,a=-1;clearTimeout(a);var i=t;a=setTimeout(function(){if(n(e.keyView).is(":visible")&&i&&i.target===window&&e.currentViewPort!=e.getCurrentViewPort()){e.currentViewPort=e.getCurrentViewPort();n(window).height();95,e.reloadDashboard(e.currentDashboardId,!1)}},600)},splitWidget:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;function i(t){return t==parseFloat(t)?!(t%2):void 0}t.preventDefault();var r,o,d=this.getGrid().data("gridstack"),s=n(t.currentTarget).closest(".grid-stack-item"),l=s.attr("data-gs-x"),h=s.attr("data-gs-y"),c=s.attr("data-gs-width"),u=s.attr("data-gs-height"),b=i(c),f=i(u);"right"===e&&(c=Math.floor(s.attr("data-gs-width")/2),l=Math.round(s.attr("data-gs-x"))+c,r=b?c:c+1,o=u),"bottom"===e&&(u=Math.floor(s.attr("data-gs-height")/2),h=Math.round(s.attr("data-gs-y"))+u,r=c,o=f?u:u+1),d.resize(s,c,u);var g=this.dashboardModel.getItemModel("#"+s.attr("id"));g.currentResult.width=c,g.currentResult.height=u,g.itemType=a||"empty",this.dashboardModel.updateSizes(!0,!0);var m={x:l,y:h,width:r,height:o};this.dashboardTabs.addNewWidget(this.dashboardTabs,m,g),this.dashboardModel.setStateModified(!0)},removeWidget:function(t){t.preventDefault();var e=this.getGrid().data("gridstack"),a=n(t.currentTarget).closest(".grid-stack-item");e.remove_widget(a);var i=this.dashboardModel.getItemModel("#"+a.attr("id"));this.dashboardModel.removeItemModel(i),this.dashboardModel.setStateModified(!0)},isBreakpoint:function(t){return n(".device-"+t).is(":visible")},afterAddWidget:function(){this.getGrid().data("gridstack"),this.getCurrentViewPort()},afterChangeWidget:function(t){this.getGrid().data("gridstack"),this.getCurrentViewPort();var e=this.dashboardModel.getItemModel("#"+t);e.currentResult.x=n("#"+t).attr("data-gs-x"),e.currentResult.y=n("#"+t).attr("data-gs-y"),e.currentResult.width=n("#"+t).attr("data-gs-width"),e.currentResult.height=n("#"+t).attr("data-gs-height")},afterGridChange:function(){this.getGrid().data("gridstack")&&(this.isBreakpoint("xs")||(this.isBreakpoint("sm")||(this.isBreakpoint("md")||this.isBreakpoint("lg"))))},prepareWidgets:function(t,e){var a,i,r=[],o=this.grid.grid.nodes;return r.lg=[],r.md=[],r.sm=[],r.xs=[],n.each(o,function(t,n){switch(e){case"lg":a=1===n.width?n.width:n.width/2,a=Math.floor(a),i=0===n.x?n.x:n.x/2,i=Math.floor(i);var o={height:n.height,maxHeight:n.maxHeight,maxWidth:n.maxWidth,minHeight:n.minHeight,minWidth:n.minWidth,width:n.width,x:n.x,y:n.y,id:n.id},d={height:n.height,maxHeight:n.maxHeight,maxWidth:a,minHeight:n.minHeight,minWidth:a,width:a,x:i,y:n.y,id:n.id};a=1===n.width||2===n.width?n.width:2,i=n.width>1?0:n.x>=1?1:0;var s={height:n.height,maxHeight:n.maxHeight,maxWidth:a,minHeight:n.minHeight,minWidth:a,width:a,x:i,y:n.y,id:n.id};r.lg.push(o),r.md.push(d),r.sm.push(d),r.xs.push(s);break;case"sm":case"md":d={height:n.height,maxHeight:n.maxHeight,maxWidth:n.maxWidth,minHeight:n.minHeight,minWidth:n.minWidth,width:n.width,x:n.x,y:n.y,id:n.id};a=2*n.width,a=Math.floor(a),i=2*n.x,i=Math.floor(i);o={height:n.height,maxHeight:n.maxHeight,maxWidth:a,minHeight:n.minHeight,minWidth:a,width:a,x:i,y:n.y,id:n.id};a=1===n.width||2===n.width?n.width:2,i=a>=2?0:0===n.x||1===n.x?n.x:0;s={height:n.height,maxHeight:n.maxHeight,maxWidth:a,minHeight:n.minHeight,minWidth:a,width:a,x:i,y:n.y,id:n.id};r.lg.push(o),r.md.push(d),r.sm.push(d),r.xs.push(s)}}),r},getSerializedDataForViewport:function(t){var e=localStorage.getItem("@DashboardName-"+t);return e=JSON.parse(e)},getCurrentViewPort:function(){var t;return this.isBreakpoint("xs")?t="xs":this.isBreakpoint("sm")?t="sm":this.isBreakpoint("md")?t="md":this.isBreakpoint("lg")&&(t="lg"),t},getOptionsMenu:function(){var t=this,e={callback:function(e,i){switch(e){case"columnchart":case"complexchart":case"table":case"nodetable":case"wizard":case"filter":var r=n("#"+i).closest(".grid-stack-item"),o=["variable"];"wizard"==e&&(o=null,e=void 0),"filter"==e&&(o=["index","decision","inputnode"],e=void 0),function(t,e,i){a.e(31).then(function(){var n=[a(928)];(function(a){(new a).show(t,{callback:i,filteredClasses:e})}).apply(null,n)}).catch(a.oe)}(event,o,function(a){var n=a.nodeId;if("module"==a.nodeClass)t.createNewView({itemType:"objectItem",objectType:"diagramviewer",itemProperties:{diagramOptions:{currentModule:n}}});else{var r=t.dashboardModel.getItemModel("#"+i);r.grid=t.grid,r.currentResult.itemProperties={},r.currentResult.itemType="objectItem",r.currentResult.objectType=e,r.model=t.dashboardModel,r.initializeWithNode(n)}});break;case"inputform":!function(t,e){a.e(46).then(function(){var i=[a(1025)];(function(a){(new a).show(t,{callback:e})}).apply(null,i)}).catch(a.oe)}(event,function(a){var r=a.templateId,o=a.name,d=t.dashboardModel.getItemModel("#"+i),s=n("#"+i).closest(".grid-stack-item");t.grid.remove_widget(s),d.grid=t.grid,d.currentResult.itemProperties={templateId:r,inputForm:{templateId:r},title:{text:o,style:{color:"#000"},enabled:!0},subtitle:{style:{color:"#000"}}},d.currentResult.itemType="objectItem",d.currentResult.objectType=e,d.model=t.dashboardModel,d.editMode=!0,d.createNewView(d.currentResult)});break;case"texteditor":case"diagramviewer":case"mapviewer":case"menuwidget":var d=t.dashboardModel.getItemModel("#"+i);r=n("#"+i).closest(".grid-stack-item");t.grid.remove_widget(r),d.grid=t.grid,d.currentResult.itemProperties={},d.currentResult.itemType="objectItem",d.currentResult.objectType=e,d.model=t.dashboardModel,d.editMode=!0,d.createNewView(d.currentResult)}},items:{}};return e.items.texteditor={type:"icon_text",name:"Text",iconClass:""},e.items.mapviewer={type:"icon_text",name:"Gis Map",iconClass:""},e.items.inputform={type:"icon_text",name:"Input Form",iconClass:""},e.items.wizard={type:"icon_text",name:"Wizard",iconClass:""},e.items.filter={type:"icon_text",name:"Filter",iconClass:""},e.items.menuwidget={type:"icon_text",name:"Menu",iconClass:""},e},moreChartTypesMenu:function(t){var e='div[data-gs-id="'+t+'"] .moreChartTypes',a=this.getOptionsMenu();if(a&&(this.menuInitiated&&n.contextMenu("destroy",e),!n.isEmptyObject(a.items))){var i=this;this.menuInitiated=!0,n.contextMenu({selector:e,callback:function(e,n){a.callback(e,t),a.items&&a.items[e]&&a.items[e].persist&&setTimeout(function(){i.moreChartTypesMenu()},100)},items:a.items})}this.menuInitiated&&n(e).contextMenu()},closeToolbar:function(){var t,e=n(".popover");Promise.resolve().then(function(){var i=[a(706)];(function(a){var i=(new a).getItemsModel();n.each(i,function(t,e){n(e.tagId).css("z-index",1)}),e.length>0&&(t=e.attr("data-id"),e.remove(),n(t).css("z-index",1),n(".dash-overlay").hide())}).apply(null,i)}).catch(a.oe)},recalcWidgets:function(t,e){var a,i=this.getCurrentViewPort(),n=t;switch(e){case"xs":a=o.map(n,function(t){var e,a=1===t.width||2===t.width?t.width:2;e=a>=2?0:0===t.x||1===t.x?t.x:0;var i=Object.assign({},t);return i.width=a,i.x=e,i},this);break;case"sm":case"md":var r=2;"xs"===i&&(r=3);a=o.map(n,function(t){var e=t.width*r;e=Math.floor(e);var a=t.x*r;a=Math.floor(a);var i=Object.assign({},t);return i.width=e,i.x=a,i},this);break;case"lg":r=2;"xs"===i&&(r=6),a=o.map(n,function(t){var e=t.width*r;e=Math.floor(e);var a=t.x*r;a=Math.floor(a);var i=Object.assign({},t);return i.width=e,i.x=a,i},this)}return a},reloadDashboard:function(t,a){var i=this;n(".tabs-area").find(".toolbar").hide(),this.dashboardModel||(this.dashboardModel=new e({dashId:t,dashboardViewList:[],nodeOwner:"",extraOptions:null}));var r=this.dashboardModel.getItemsModel();n.each(r,function(t,e){n(e.tagId).trigger("removeItemView")}),i.dashboardModel.removeAllItemsModel(),i.grid&&i.grid.removeAll(),i.getParent().find(".grid-stack.dashboard-area").empty(),this.dashboardModel.getDashboard(t,function(e){n('.nav-tabs li a[data-rel="'+t+'"]').text(e.name),i.getParent().attr("dash-title",e.name);var r=i.getCurrentViewPort(),o=12,d={};if(e.definition){switch(d=e.definition,r){case"xs":d=d.definitionSmall?d.definitionSmall:d.definitionMedium?i.recalcWidgets(d.definitionMedium,"xs"):i.recalcWidgets(d.definitionLarge,"xs"),o=2;break;case"sm":case"md":d.definitionMedium?(d=d.definitionMedium,i.getGrid().removeClass("grid-stack-autoposition")):d.definitionLarge?(i.getGrid().addClass("grid-stack-autoposition"),d=d.definitionLarge):(i.getGrid().addClass("grid-stack-autoposition"),d=i.recalcWidgets(d.definitionSmall,"md")),o=6;break;case"lg":d.definitionLarge?(d=d.definitionLarge,i.getGrid().removeClass("grid-stack-autoposition")):d=d.definitionMedium?i.recalcWidgets(d.definitionMedium,"lg"):i.recalcWidgets(d.definitionSmall,"lg"),o=12}e.definition=d}else switch(i.currentViewPort){case"xs":o=2;break;case"sm":case"md":o=6;break;case"lg":o=12}i.getGrid().removeClass("grid-stack-12").removeClass("grid-stack-6").removeClass("grid-stack-2"),i.getGrid().addClass("grid-stack-"+o),i.getGrid().data("gridstack").setGridWidth(o),window.location.href.indexOf("/#shared/")>0?(n(".tabs-area .toolbar").hide(),n(".loader.embeddable").hide(),n("body").css("background-color","#FFF")):i.dashboardTabs.refreshDashboardTabs(),i.dashboardModel.attributes.imOwner=e.ownerId===__currentSession.userCompanyId,i.refreshDashboardName(e),i.dashboardModel.setNodeOwner(e.node),i.parseDashboard(e,a),i.getParent().find("div.breadcrumbs2").show(),i.checkShared(e,a),i.checkFromDiagram(e),n(".tabs-area").find(".toolbar").show(),window.location.href.indexOf("/#shared/")>0&&(n(".loadingPlaceholder").hide(),n(".loader.embeddable").hide(),n("body").css("background-color","#FFF")),i=null})},checkFromDiagram:function(t){""!==t.node&&null!==t.node&&(n(".tabs-area").find(".toolbar .btnCopy").hide(),n(".tabs-area").find(".toolbar .btnShare").hide())},checkShared:function(t,e){if(this.dashboardModel.attributes.imOwner)e||(n(".tabs-area").find(".toolbar .btnEdit").show(),n(".tabs-area").find(".toolbar .btnShare").show(),n(".tabs-area").find(".toolbar .shared-message").html(""));else{n(".tabs-area").find(".toolbar .btnEdit").hide(),n(".tabs-area").find(".toolbar .btnShare").hide(),t.sharedBy?n(".tabs-area").find(".toolbar .shared-message").html((0,l.translate)("full_shared_by")+": "+t.sharedBy):n(".tabs-area").find(".toolbar .shared-message").html((0,l.translate)("Is shared"));var a=this;this.getParent().on("refreshImageDashboard",function(t,e){a.reloadDashboard(e)})}},refreshDashboardName:function(t){if(t){var e=t.dashboardId,a=t.name;this.dashboardName=a,n("span[data-rel='dashboard-"+e+"']").text(a),n("#topMenuBar li a[rel='dashboard-"+e+"']").text(a),n(".dash-tabs li a[data-rel='"+e+"']").text(a),n(".dash-tabs li a[data-rel='"+e+"']").attr("title",a)}},removeDashboard:function(t){Promise.resolve().then(function(){var e=[a(684)];(function(e){(new e).removeTask(t)}).apply(null,e)}).catch(a.oe)},parseDashboard:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this,r=t.definition;this.dashboardModel.setStyleLibraries(t.styleLibraries);var o=i.dashboardModel.get("extraOptions")&&i.dashboardModel.get("extraOptions").isInputNode;if(t.definition&&!o||!t.node||this.dashboardController.getEmptyContent(this.dashboardModel,function(a){var r=i.getCurrentViewPort(),d=12;"sm"!==r&&"md"!==r||(d=6);var s=n("#main").height()-80,l=Math.floor(s/65);a.setElement(n("div.grid-stack")),a.grid=i.grid,a.dashboardModel=i.dashboardModel,a.currentResult={x:0,y:0,width:d,height:l},a.loadingDashboard=!0,a.render(),i.dashboardModel.addItemToModel(a),a.initializeWithNode(t.node,!!o&&"nodetable"),t.definition&&""!=t.definition&&!o||e&&n("div.toolbar button.btnEdit").click()}),r&&r.length>0){var d=[],s=[];r.noQuery&&r.noQuery.length>0&&void 0!=r.noQuery[0].rel&&(d=r.noQuery,n.each(d,function(t,e){n.each(e.rel,function(t,e){s.push(e)})})),i.noQuery=d,i.ownerWidth=r.ownerWidth,i.ownerHeight=r.ownerHeight,i.dashboardModel.initializeDashboardQuery(i.noQuery);var l=d.indexOf(r.nodeId)>=0;n.each(r,function(t,e){"empty"===e.itemType?Promise.resolve().then(function(){var t=[a(702)];(function(t){(new t).getEmptyContent(i.dashboardModel,function(t){t.setElement(n("div.grid-stack")),t.grid=i.grid,t.currentResult=e,t.dashboardModel=i.dashboardModel,t.loadingDashboard=!0,t.render(),n(t.tagId).find(".btnMenu").hide(),i.dashboardModel.addItemToModel(t)})}).apply(null,t)}).catch(a.oe):a.e(0).then(function(){var t=[a(722)];(function(t){var a=new t({model:i.dashboardModel});a.setElement(n("div.grid-stack")),a.grid=i.grid,a.dashboardModel=i.dashboardModel,a.loadingDashboard=!0,a.widget=e,i.dashboardModel.addItemToModel(a),a.createNewView(e,l)}).apply(null,t)}).catch(a.oe)})}t.definition&&!o||e&&(n("div.toolbar button.btnEdit").click(),setTimeout(function(t){i.dashboardTabs.addNewWidget(i.dashboardTabs)},100)),i.fromExternal&&setTimeout(function(){i.initPromiseWatcher()},1e3)},resetView:function(){this.checkNodeOwner()||this.createNewView({itemType:"empty"})},getThis:function(){return n(this.keyView)},onRemoveView:function(){n(".tabs-area").remove(),n(".mainTask.dashboardTask.new").length<1&&n(window).off("resize.updateSizes"),0===n(".mainTask.dashboardTask.new").length&&n(window).off("keyup.closeTabs"),n(this.keyView).off(),this.dashboardController=null;var t=this.dashboardModel.getItemsModel();n.each(t,function(t,e){n(e.tagId).trigger("removeItemView")}),this.dashboardModel.removeAllItemsModel(),this.dashboardModel=null,this.noQuery=null;var e=this;setTimeout(function(){e.dashboardTabs.refreshDashboardTabs(),e.dashboardTabs.getModel()&&e.dashboardTabs.checkFromDiagram(e.dashboardTabs.getModel().attributes),e=null},100)},onBeforeRemoveView:function(t,e){if(n(".mainTask.dashboardTask.new").length<1&&n(window).off("resize.updateSizes"),this.dashboardModel.editMode){t.preventDefault();var i=this;a.e(3).then(function(){var t=[a(683)];(function(t){(new t).show({title:(0,l.translate)("_save")+": "+i.dashboardName,text:(0,l.translate)("save_pending_changes"),buttons:[{title:(0,l.translate)("yes"),css:"primary",code:"yes"},{title:(0,l.translate)("no"),code:"no"},{title:(0,l.translate)("cancel"),code:"cancel"}],callback:function(t){"yes"==t?(i.refreshMode(!1),i.saveDashboard(),setTimeout(function(){e()},1e3)):"no"==t&&(i.dashboardModel.editMode=!1,setTimeout(function(){e(!0)},1e3))}})}).apply(null,t)}).catch(a.oe)}},refreshMode:function(t){this.dashboardModel.editMode=t,this.getParent().find("div.toolbar button").hide();var e=this.dashboardModel.getItemsModel();n.each(e,function(e,a){a.setEditMode(t)}),t?(this.getParent().find(".dash-tabs").hide(),this.getParent().closest(".mainTask").addClass("editing"),this.getParent().find("div.toolbar button.btnShow").show(),this.getParent().find("div.toolbar button.btnCancel").show(),this.getParent().find("div.objectsToolbar").fadeIn(),this.getParent().find(".dockDashboardProperty").fadeIn()):(this.getParent().find(".dash-tabs").show(),this.getParent().closest(".mainTask").removeClass("editing"),this.getParent().find("div.toolbar button").show(),this.getParent().find("div.toolbar button.btnShow").hide(),this.getParent().find("div.toolbar button.btnCancel").hide(),this.getParent().find("div.objectsToolbar").fadeOut(),this.getParent().find(".dockDashboardProperty").fadeOut())},addGenericHandlers:function(){var t=n(this.keyView),e=this;void 0!==__currentSession.fromEmbedded&&(this.fromEmbedded=__currentSession.fromEmbedded),this.fromEmbedded||t.on("click",".link-to-dashboard",function(){if(!e.dashboardModel.editMode){var t=n(this).attr("data-dashboard-id"),i=(0,l.translate)("loading_dashboard"),r=!0;if("_self"===n(this).attr("data-target")&&(r=!1),e.dashboardController.showDashboard(t,-1,i,!0,e.dashboardModel.editMode),!r){var o=e.getParent().attr("data-rel");Promise.resolve().then(function(){var t=[a(684)];(function(t){(new t).removeTask(o,!0)}).apply(null,t)}).catch(a.oe)}}})},addHandlers:function(){1===n(".mainTask.dashboardTask.new").length&&n(window).on("keyup.closeTabs",function(t){t.ctrlKey&&81===t.keyCode&&n(".tabs-area .dash-tabs li a.active").closest("li").find("i.fa.fa-close").click()})},getParent:function(){return n(this.keyView)},getGrid:function(){return n(".grid-dash-"+this.currentDashboardId)},initPromiseWatcher:function(){if(this.dashboardModel){var t=this.dashboardModel.getItemsModel();if(t&&t.length>0){var e=!0;if(n.each(t,function(t,a){0==n(a.tagId).find(".item-class-selector").length&&(e=e&&a.isReady)}),!e&&this.getParent().find(".dashboard-area").length>0){var a=this;setTimeout(function(){a.initPromiseWatcher(),a=null},1e3)}}}}})}.apply(e,d))||(t.exports=s)}).call(this,a(218),a(1),a(1),a(220))}}]);